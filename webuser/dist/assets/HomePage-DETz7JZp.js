import{j as t,u as y,r as i,L as E}from"./index-Wx5DAnrH.js";import{A as I,a as D}from"./Alert-BdvLvEOP.js";import{S as L}from"./SelectInput-CnhQdi0H.js";const S=({label:d,name:h,value:u,onChange:m,placeholder:n,errorMessage:l,require:f})=>t.jsxs("div",{className:"flex flex-col gap-1 relative",children:[t.jsxs("label",{className:"text-header text-md",children:[d," ",f&&t.jsx("span",{className:"text-error",children:"*"})]}),t.jsx("input",{type:"text",name:h,value:u,onChange:m,className:`border-2  focus:border-primary placeholder:text-lightGray hover:border-lightGray  
                w-full rounded py-1.5 px-2 text-base outline-none ${l?"border-error focus:border-error":"border-secondary"}`,placeholder:n}),l&&t.jsx(I,{variant:"destructive",className:"text-error text-sm",children:l})]}),P=4,w=11,C=/^[\u0E00-\u0E7F0-9]*$/,G=()=>{const d=y(),[h,u]=i.useState(!1),[m,n]=i.useState({}),[l,f]=i.useState([]),p=sessionStorage.getItem("licenseData"),[s,x]=i.useState(p?JSON.parse(p):{License_ID:"",Province:null});i.useEffect(()=>{g()},[]);const g=async()=>{try{const o=(await(await fetch("https://raw.githubusercontent.com/kongvut/thai-province-data/master/api_province_with_amphure_tambon.json")).json()).map(a=>a.name_th);f(o)}catch(e){console.error("Error fetching provinces:",e),n(r=>({...r,Province:"ไม่สามารถโหลดข้อมูลจังหวัดได้ กรุณาลองใหม่อีกครั้ง"}))}},v=e=>{if(!e)return"กรุณากรอกหมายเลขทะเบียนรถ";if(!C.test(e))return"กรุณากรอกภาษาไทยและตัวเลขเท่านั้น";if(e.length<P)return"กรุณาใส่หมายเลขทะเบียนที่มีความยาวมากกว่า 4 ตัวอักษร";if(e.length>w)return"กรุณาใส่หมายเลขทะเบียนที่มีความยาวไม่เกิน 10 ตัวอักษร"},b=e=>{const{name:r,value:o}=e.target;if(x(a=>({...a,[r]:o})),r==="License_ID"){const a=v(o);n(c=>({...c,License_ID:a}))}},N=e=>{x(r=>({...r,Province:e})),n(r=>({...r,Province:void 0}))},j=async()=>{var o,a;const e={},r=v(s.License_ID);if(r&&(e.License_ID=r),s.Province||(e.Province="กรุณาเลือกจังหวัด"),Object.keys(e).length>0){n(e);return}u(!0);try{const c=await D.get("/parkingrecord-active/searchUser",{params:{license_id:s.License_ID,province:(o=s.Province)==null?void 0:o.value,searchMode:"exact"}});c.data.meta.total===0?d("/option",{state:{license_id:s.License_ID,province:(a=s.Province)==null?void 0:a.value}}):d("/detail",{state:{data:c.data.data[0]}})}catch(c){console.error("Error fetching data:",c),n(_=>({..._,submit:"เกิดข้อผิดพลาดในการค้นหา กรุณาลองใหม่อีกครั้ง"}))}finally{u(!1)}};return i.useEffect(()=>{sessionStorage.setItem("licenseData",JSON.stringify(s))},[s]),h?t.jsx(E,{}):t.jsxs("div",{className:" text-header",children:[t.jsx("header",{className:"",children:t.jsx("h1",{className:"text-lg font-bold text-center pt-8",children:"ค้นหาตำแหน่งรถ"})}),t.jsx("div",{className:"flex-grow w-full h-52 flex justify-center mt-6 mb-6",children:t.jsx("img",{src:"/src/assets/findCar.svg",alt:"Find Car",className:"w-full object-contain rounded"})}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(S,{require:!0,label:"เลขทะเบียน",name:"License_ID",value:s.License_ID,onChange:b,placeholder:"กรอกหมายเลขทะเบียน",errorMessage:m.License_ID}),t.jsx(L,{require:!0,label:"จังหวัด",options:l.map(e=>({value:e,label:e})),value:s.Province,onChange:N,placeholder:"เลือกจังหวัด",errorMessage:m.Province})]}),t.jsx("div",{className:"fixed bottom-0 left-0 right-0 px-6 py-4 bg-white border-t border-gray-300",children:t.jsx("button",{onClick:j,className:"w-full flex justify-center rounded-full p-2 font-medium bg-primary text-secondary hover:bg-primary/90",children:"ค้นหา"})})]})};export{G as HomePage,G as default};
