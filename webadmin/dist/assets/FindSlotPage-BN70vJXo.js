import{a as R,r as a,A as E,u as $,j as t,L as _}from"./index-Bluomjo3.js";import{u as O}from"./BaseSocketService-Bl9hlbK-.js";import{P as V}from"./ParkingSocketService-CWr6cezM.js";import{B as H}from"./Breadcrumb-C_-aqw1f.js";import{S as q,C as J,a as L}from"./SearchDisplay-Hgc5dbHY.js";import{C as K}from"./CarInfoDisplay-BTOMC0tr.js";import{M as Q}from"./MapDisplay-UgpScvv1.js";import"./createLucideIcon-BSuAhcd7.js";import"./ImageConfig-BSyY58UR.js";const W=()=>{const{token:j}=R(),s=O(V,!0),[p,v]=a.useState(!1),[N,i]=a.useState(!0),[y,o]=a.useState(null),[r,n]=a.useState("floorMap"),[f,S]=a.useState({zone:"A",floor:"01",slot:null,spot:null}),[M,h]=a.useState(null),[I,l]=a.useState({parking_id:"",floor:"",zone:"",slot:"",spot:"",x_coordinate:0,y_coordinate:0,z_coordinate:0}),[F,g]=a.useState([{occupied:[],available:[],summary:{total:0,occupied:0,available:0,location:{zone:"A",floor:"01"}}}]),x=a.useCallback(e=>e.zone?e.floor?e.spot&&!e.slot?(o("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ñ‡∏ß‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î‡∏£‡∏ñ"),!1):e.slot&&!e.spot?(o("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ñ‡∏ß‡∏à‡∏≠‡∏î‡∏£‡∏ñ"),!1):(o(null),!0):(o("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ"),!1):(o("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ"),!1),[]),b=async e=>{if(!j){o("Unauthorized: No token available"),i(!1);return}i(!0);try{const d=await(await fetch(`${E.baseURL}/parkingrecord-active/findBySlot/${e}`,{method:"GET",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"}})).json();d.message?(o(d.message),h(null),l(null),n("search")):(l(d.slotInfo),h(d.carInfo),n("carInfo"),o(null))}catch(c){console.error("Fetch slot data error:",c),o("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"),n("search")}finally{i(!1)}},u=a.useCallback(()=>{if(!(s!=null&&s.connected)||!p){o("‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...");return}if(x(f)){i(!0);try{s.emit("getSlotStatus",{zone:f.zone,floor:f.floor},e=>{e.success?(g(e.data),o(null)):o(e.error||"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ"),i(!1)})}catch(e){console.error("Error fetching slot data:",e),o("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"),i(!1)}}},[s,p,f,x]),w=async e=>{if(!j){o("Unauthorized: No token available"),i(!1);return}i(!0);try{const c=await fetch(`${E.baseURL}/parkingrecord-active/slot?${new URLSearchParams(e)}`,{method:"GET",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"}});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const d=await c.json();d.message?(o(d.message),h(null),l(null),n("search")):(l(d.slotInfo),h(d.carInfo),n("carInfo"),o(null))}catch(c){console.error("Fetch slot data error:",c),o("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏"),n("search")}finally{i(!1)}},z=a.useCallback(e=>{const{page:c,limit:d,...C}=e;if(!Object.values(C).some(k=>k!==void 0&&k!==""&&k!==null))return;const m={...f,...Object.entries(C).reduce((k,[T,D])=>({...k,[T]:D===void 0?null:D}),{}),page:1};x(m)&&(S(m),i(!0),e.zone&&e.floor&&!e.slot&&!e.spot?(n("floorMap"),u()):e.zone&&e.floor&&e.slot&&e.spot&&w({zone:e.zone,floor:e.floor,slot:e.slot,spot:e.spot}))},[f,u,x]),U=a.useCallback(()=>{n("floorMap"),o(null),S({zone:"A",floor:"01",slot:null,spot:null}),u()},[u]),G=a.useCallback(e=>{const c=e.id.split("-")[0];b(c)},[b]),A=a.useCallback(()=>{n("floorMap"),h(null),l(null),o(null)},[]);return a.useEffect(()=>{if(!s)return;const e=()=>{console.log("üîó Socket connected successfully"),v(!0)},c=()=>{console.log("‚ö†Ô∏è Socket disconnected"),v(!1),o("‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà...")},d=m=>{m.success&&(g(m.data),o(null))},C=m=>{m.success&&r==="floorMap"&&u()},B=m=>{m.success&&(r==="floorMap"&&u(),r==="carInfo"&&A())};return s.on("connect",e),s.on("disconnect",c),s.on("slotStatusUpdated",d),s.on("recordCreated",C),s.on("recordRemoved",B),s.connected&&v(!0),()=>{s.off("connect",e),s.off("disconnect",c),s.off("slotStatusUpdated",d),s.off("recordCreated",C),s.off("recordRemoved",B)}},[s,r,u,A]),a.useEffect(()=>{p&&r==="floorMap"&&u()},[p,r,u]),{loading:N,isConnected:p,error:y,slotData:I,slotStatsData:F,selectedCar:M,filters:f,viewMode:r,handleSearch:z,handleClear:U,handleClick:G,handleBack:A}},le=()=>{var x,b,u;const j=$(),{isAuthenticated:s,isLoading:p}=R(),{loading:v,error:N,slotData:i,slotStatsData:y,selectedCar:o,viewMode:r,filters:n,handleSearch:f,handleClear:S,handleClick:M,handleBack:h}=W(),[I]=a.useState([{header:"‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ",key:"zone",placeholder:"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î",type:"select",options:[{label:"A",value:"A"},{label:"B",value:"B"}]},{header:"‡∏ä‡∏±‡πâ‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ",key:"floor",placeholder:"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ",type:"select",options:[{label:"01",value:"01"},{label:"02",value:"02"}]}]);if(p||v)return t.jsx(_,{message:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•..."});if(!s)return j("/"),null;const l=y==null?void 0:y[0],F=()=>{var w,z;return l?t.jsx("div",{children:t.jsx(Q,{slot:l.occupied,slotEmpty:l.available,camera:null,map:(z=(w=l.summary)==null?void 0:w.location)==null?void 0:z.zone,handleClick:M})}):t.jsx(t.Fragment,{})},g=!l||((x=l.summary)==null?void 0:x.total)===0;return t.jsxs("div",{className:"flex flex-col gap-4 p-4",children:[t.jsx(H,{pageName:"‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î"}),r!=="carInfo"&&t.jsx(q,{searchConfig:I,onSearch:f,onClear:S,filters:n}),t.jsxs("div",{className:"bg-white p-4 rounded",children:[t.jsx("div",{className:"flex justify-between items-center pb-4 w-full",children:t.jsxs("div",{className:"text-header w-full",children:[r==="floorMap"&&l&&t.jsxs("div",{className:"flex w-full justify-between",children:[t.jsxs("p",{children:["‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ ",n.zone," ‡∏ä‡∏±‡πâ‡∏ô ",n.floor," (",l.summary.total||0,")"]}),t.jsxs("div",{className:"flex gap-4 mb-2 mt-4",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-4 h-4 bg-green-500 rounded mr-2"}),t.jsxs("span",{className:"text-mediumGray",children:["‡∏ß‡πà‡∏≤‡∏á: ",((b=l.summary)==null?void 0:b.available)||0]})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-4 h-4 bg-red-500 rounded mr-2"}),t.jsxs("span",{className:"text-mediumGray",children:["‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á: ",((u=l.summary)==null?void 0:u.occupied)||0]})]})]})]}),(r==="search"||r==="carInfo")&&t.jsxs("button",{onClick:h,className:"flex items-center text-mediumGray hover:text-primary",children:[t.jsx(J,{className:"w-5 h-5 mr-1"}),t.jsx("span",{children:"‡∏Å‡∏•‡∏±‡∏ö"})]})]})}),N&&t.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(L,{className:"w-5 h-5 mr-2"}),N]}),t.jsx("button",{onClick:S,className:"text-primary hover:underline ml-1 mt-2",children:"‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤"})]}),r==="floorMap"&&!g&&F(),r==="carInfo"&&o&&i&&t.jsx(K,{selectedCar:o,slotData:i}),g&&r==="floorMap"&&t.jsx("div",{className:"flex flex-col items-center justify-center py-12 rounded-lg",children:t.jsxs("div",{className:"text-mediumGray mb-2 flex items-start gap-2",children:[t.jsx(L,{className:"w-5 h-5"}),"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î ",n.zone," ‡∏ä‡∏±‡πâ‡∏ô ",n.floor,t.jsx("button",{onClick:S,className:"text-primary hover:underline",children:"‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô"})]})})]})]})};export{le as default};
