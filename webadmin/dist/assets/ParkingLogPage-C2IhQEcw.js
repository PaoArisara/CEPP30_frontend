import{a as J,r as n,A as W,j as e,u as Y,L as Z}from"./index-Bluomjo3.js";import{u as ee}from"./BaseSocketService-Bl9hlbK-.js";import{L as te,X as V}from"./LogSocketService-BMGU2aUu.js";import{B as se}from"./Breadcrumb-C_-aqw1f.js";import{S as ae,a as ne}from"./SearchDisplay-Hgc5dbHY.js";import{D as U,a as F,T as ie,H as le}from"./TableDisplay-DKLLAhU6.js";import{g as X}from"./ImageConfig-BSyY58UR.js";import{D as z,a as R}from"./Dialog-Bf6WNdOJ.js";import{P as K}from"./Pagination-D6bEGNZS.js";import{c as oe}from"./createLucideIcon-BSuAhcd7.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],ce=oe("Search",re),de=[{label:"à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸£à¸–",key:"license"},{label:"à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸ˆà¸­à¸”",key:"location"},{label:"à¹€à¸§à¸¥à¸²à¹€à¸‚à¹‰à¸²",key:"timeIn"},{label:"à¹€à¸§à¸¥à¸²à¸­à¸­à¸",key:"timeOut"}],me={page:1,limit:10},he=()=>{const{token:h}=J(),a=ee(te,!0),[t,d]=n.useState(!1),[o,x]=n.useState(!0),[C,r]=n.useState(null),[p,P]=n.useState({data:[],meta:{total:0,totalPages:0,page:1,limit:10}}),[y,k]=n.useState("AB"),[H,L]=n.useState(new Date),[I,G]=n.useState(null),[O,b]=n.useState(!1),[A,w]=n.useState(!1),[T,_]=n.useState(!1),[E,$]=n.useState(null),[S,B]=n.useState(me),u=n.useCallback(async s=>{if(!(a!=null&&a.connected)||!t){r("à¸£à¸­à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­...");return}p.data.length>0||x(!0);try{const N={...S,zone:s!=="AB"?s:null,timestamp:new Date().toISOString()};a.emit("getLogs",N,g=>{g.success&&g.data?(P(g.data),L(new Date),r(null)):r(g.error||"à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰"),x(!1)})}catch(N){console.error("Error fetching logs:",N),r("à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥"),x(!1)}},[a,t,S,p.data.length]),f=n.useCallback(s=>{console.log("Received log update:",s),s.success&&(u(y),L(new Date))},[u,y]);n.useEffect(()=>{if(!a)return;const s=()=>{console.log("ðŸ”— Socket connected successfully"),d(!0)},m=()=>{console.log("âš ï¸ Socket disconnected"),d(!1),r("à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸‚à¸±à¸”à¸‚à¹‰à¸­à¸‡ à¸à¸³à¸¥à¸±à¸‡à¸žà¸¢à¸²à¸¢à¸²à¸¡à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹ƒà¸«à¸¡à¹ˆ...")};return a.on("connect",s),a.on("disconnect",m),a.on("logCreated",f),a.on("logUpdated",f),a.on("statsUpdated",f),a.connected&&d(!0),()=>{a.off("connect",s),a.off("disconnect",m),a.off("logCreated",f),a.off("logUpdated",f),a.off("statsUpdated",f)}},[a,f]);const M=async(s,m=1,N=10)=>{if(console.log("Fetching history data:",{license_id:s,token:h,page:m,limit:N}),!h){r("Unauthorized: No token available"),_(!1);return}_(!0);try{const g=await fetch(`${W.baseURL}/vehicles/${s}/history?page=${m}&limit=${N}`,{method:"GET",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}});if(!g.ok){const Q=await g.text();throw new Error(Q||"Failed to fetch vehicle history")}const q=await g.json();console.log("Fetched history data:",q),$(q),r(null)}catch(g){console.error("Fetch vehicle history error:",g),r("à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥")}finally{_(!1)}},i=n.useCallback(s=>{const m={...s,page:1,timestamp_in:s.timestamp_in instanceof Date?s.timestamp_in.toISOString():s.timestamp_in,timestamp_out:s.timestamp_out instanceof Date?s.timestamp_out.toISOString():s.timestamp_out};B(N=>({...N,...m})),console.log(S)},[]),v=n.useCallback(()=>{B({page:1,limit:10})},[]),D=n.useCallback(s=>{k(s),u(s)},[u]),l=n.useCallback(s=>{B(m=>({...m,page:s}))},[]),c=n.useCallback((s,m)=>{G(s),m==="info"?(b(!0),w(!1)):(console.log("history"),w(!0),console.log(A),b(!1),M(s.license_id))},[M]),j=n.useCallback(()=>{b(!1),w(!1),G(null)},[]);return n.useEffect(()=>{t&&u(y)},[t,y,S,u]),{loading:o,isConnected:t,error:C,logs:p,filters:S,activeMap:y,lastRefreshTime:H,selectedCar:I,showCarHistoryModal:A,showCarInfoModal:O,historyLoading:T,history:E,handleSearch:i,handlePageChange:l,handleClear:v,handleMapChange:D,handleCarSelect:c,closeModals:j,fetchParkingData:u,getCarHistory:M}},xe=({isOpen:h,onClose:a,car:t})=>{var d,o,x,C;return e.jsx(z,{open:h,onOpenChange:a,children:e.jsxs(R,{className:"max-w-lg",children:[e.jsxs(U,{children:[e.jsx("button",{onClick:a,className:"absolute top-3 right-3 text-gray-600 hover:text-gray-900",children:"âœ•"}),e.jsxs(F,{className:"text-header",children:["à¸£à¸–à¸¢à¸™à¸•à¹Œà¸—à¸°à¹€à¸šà¸µà¸¢à¸™ ",t.license_id]})]}),e.jsxs("div",{className:"space-y-4 p-4",children:[t.car_image&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:X(t.car_image),alt:"à¸£à¸¹à¸›à¸£à¸–",className:"max-w-full h-48 object-cover object-bottom rounded-lg shadow-md"})}),t.license_image&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:X(t.license_image),alt:"à¸›à¹‰à¸²à¸¢à¸—à¸°à¹€à¸šà¸µà¸¢à¸™",className:"max-w-full h-24 object-cover object-bottom rounded-lg shadow-md"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-mediumGray font-semibold",children:"à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸£à¸–"}),e.jsxs("p",{className:"text-header",children:[t.license_id," ",t.vehicle.province]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-mediumGray font-semibold",children:"à¸¢à¸µà¹ˆà¸«à¹‰à¸­à¸£à¸–"}),e.jsx("p",{className:"text-header",children:t.vehicle.vehicle_brand})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-mediumGray font-semibold",children:"à¸ªà¸µà¸£à¸–"}),e.jsx("p",{className:"text-header",children:t.vehicle.vehicle_color})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-mediumGray font-semibold",children:"à¸—à¸µà¹ˆà¸ˆà¸­à¸”à¸£à¸–"}),e.jsxs("p",{className:"text-header",children:["à¸¥à¸²à¸™à¸ˆà¸­à¸” ",(d=t.parkingSlot)==null?void 0:d.zone," à¸Šà¸±à¹‰à¸™ ",(o=t.parkingSlot)==null?void 0:o.floor," à¹à¸–à¸§ ",(x=t.parkingSlot)==null?void 0:x.slot," à¸Šà¹ˆà¸­à¸‡ ",(C=t.parkingSlot)==null?void 0:C.spot]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-mediumGray font-semibold",children:"à¹€à¸§à¸¥à¸²à¹€à¸‚à¹‰à¸²"}),e.jsx("p",{className:"text-header",children:new Date(t.timestamp_out).toLocaleString("en-GB")})]}),t.timestamp_out&&e.jsxs("div",{children:[e.jsx("p",{className:"text-mediumGray font-semibold",children:"à¹€à¸§à¸¥à¸²à¸­à¸­à¸"}),e.jsx("p",{className:"text-header",children:new Date(t.timestamp_out).toLocaleString("en-GB")})]})]})]})]})})},pe=({isOpen:h,onClose:a,car:t,onPageChange:d})=>t?e.jsx(z,{open:h,onOpenChange:a,children:e.jsxs(R,{className:"max-w-lg",children:[e.jsxs(U,{children:[e.jsx("button",{onClick:a,className:"absolute top-3 right-3 text-mediumGray hover:text-gray-900",children:e.jsx(V,{className:"w-6 h-6"})}),e.jsx(F,{className:"text-xl font-semibold text-header",children:"à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸­à¸”à¸£à¸–"})]}),e.jsxs("div",{className:"px-4 mt-2",children:[e.jsxs("p",{className:"text-lg font-medium text-header",children:[t.carInfo.vehicle.license_id," (",t.carInfo.vehicle.province,")"]}),e.jsxs("p",{className:"text-mediumGray text-sm",children:["à¸ˆà¸­à¸”à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” ",t.carInfo.totalParkings," à¸„à¸£à¸±à¹‰à¸‡ â€¢ à¹€à¸‰à¸¥à¸µà¹ˆà¸¢ ",t.carInfo.averageParkingTime]})]}),e.jsx("div",{className:"space-y-4 p-4 max-h-96 overflow-y-auto",children:t.parkingHistory.length>0?t.parkingHistory.map((o,x)=>e.jsxs("div",{className:"border rounded-lg p-4 bg-white shadow hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium text-header",children:["à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆ ",x+1+(t.meta.page-1)*t.meta.limit]}),e.jsxs("span",{className:"text-sm text-lightGray",children:["à¸Šà¹ˆà¸­à¸‡à¸ˆà¸­à¸” ",o.parkingSlot.parking_id]})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-header",children:"à¹€à¸§à¸¥à¸²à¹€à¸‚à¹‰à¸²:"})," ",e.jsx("span",{className:"text-mediumGray",children:new Date(o.timestamp_in).toLocaleString("en-GB")})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-header",children:"à¹€à¸§à¸¥à¸²à¸­à¸­à¸:"})," ",e.jsx("span",{className:"text-mediumGray",children:o.timestamp_out?new Date(o.timestamp_out).toLocaleString("en-GB"):"-"})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-header",children:"à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²à¸ˆà¸­à¸”:"})," ",e.jsx("span",{className:"text-primary",children:o.duration})]})]})]},`${o.parkingSlot.slot}-${o.timestamp_in}`)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"à¹„à¸¡à¹ˆà¸žà¸šà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸­à¸”à¸£à¸–"})}),t.meta.totalPages>1&&d&&e.jsx("div",{className:"mt-4 border-t pt-4",children:e.jsx(K,{currentPage:t.meta.page,totalPages:t.meta.totalPages,onPageChange:d,totalItems:t.meta.total,itemsPerPage:t.meta.limit})})]})}):e.jsx(z,{open:h,onOpenChange:a,children:e.jsx(R,{className:"max-w-lg",children:e.jsxs(U,{children:[e.jsx("button",{onClick:a,className:"absolute top-3 right-3 text-mediumGray hover:text-gray-900",children:e.jsx(V,{className:"w-6 h-6"})}),e.jsx(F,{className:"text-xl font-semibold",children:"à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸­à¸”à¸£à¸–"}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-mediumGray",children:"à¹„à¸¡à¹ˆà¸žà¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥"})})]})})}),ke=()=>{const h=Y(),{isAuthenticated:a,isLoading:t}=J(),[d,o]=n.useState(!1),[x,C]=n.useState([{header:"à¸§à¸±à¸™à¸—à¸µà¹ˆà¹à¸¥à¸°à¹€à¸§à¸¥à¸²à¹€à¸‚à¹‰à¸²",key:"timestamp_in",placeholder:"à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆ",type:"DateTime"},{header:"à¸§à¸±à¸™à¸—à¸µà¹ˆà¹à¸¥à¸°à¹€à¸§à¸¥à¸²à¸­à¸­à¸",key:"timestamp_out",placeholder:"à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆ",type:"DateTime"},{header:"à¹€à¸¥à¸‚à¸—à¸°à¹€à¸šà¸µà¸¢à¸™",key:"license_id",placeholder:"à¸à¸£à¸­à¸à¹€à¸¥à¸‚à¸—à¸°à¹€à¸šà¸µà¸¢à¸™",type:"text"},{header:"à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”",key:"province",placeholder:"à¹€à¸¥à¸·à¸­à¸à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”",type:"select",options:[]},{header:"à¸Šà¸±à¹‰à¸™",key:"floor",placeholder:"à¹€à¸¥à¸·à¸­à¸à¸Šà¸±à¹‰à¸™",type:"select",options:[{label:"à¸Šà¸±à¹‰à¸™ 01",value:"01"},{label:"à¸Šà¸±à¹‰à¸™ 02",value:"02"}]}]),{loading:r,logs:p,activeMap:P,error:y,selectedCar:k,showCarInfoModal:H,showCarHistoryModal:L,filters:I,history:G,getCarHistory:O,handleMapChange:b,handleSearch:A,handleClear:w,handlePageChange:T,handleCarSelect:_,closeModals:E,fetchParkingData:$}=he();n.useEffect(()=>{(async()=>{try{const l=(await(await fetch("https://raw.githubusercontent.com/kongvut/thai-province-data/master/api_province_with_amphure_tambon.json")).json()).map(c=>({label:c.name_th,value:c.name_th}));l.sort((c,j)=>c.label.localeCompare(j.label)),C(c=>c.map(j=>j.key==="province"?{...j,options:l}:j))}catch(v){console.error("Error fetching provinces:",v)}})()},[]),n.useEffect(()=>{!a&&!t&&h("/")},[a,t,h]);const S=i=>{k&&O(k.license_id,i)},B=i=>{const{page:v,limit:D,...l}=i,c=Object.values(l).some(s=>s!=null&&s!=="");o(c);const j={...l,timestamp_in:l.timestamp_in&&l.timestamp_in!==""?new Date(l.timestamp_in).toISOString():void 0,timestamp_out:l.timestamp_out&&l.timestamp_out!==""?new Date(l.timestamp_out).toISOString():void 0};A(j)},u=()=>{o(!1),w(),$("AB")},f=()=>p.data.map(i=>{var v,D,l,c;return{license:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.license_id}),e.jsx("div",{className:"text-xs text-gray-500",children:i.vehicle.province})]}),location:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm",children:["à¸Šà¸±à¹‰à¸™ ",(v=i.parkingSlot)==null?void 0:v.floor]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["à¸¥à¸²à¸™à¸ˆà¸­à¸” ",(D=i.parkingSlot)==null?void 0:D.zone," à¹à¸–à¸§ ",(l=i.parkingSlot)==null?void 0:l.slot,"-",(c=i.parkingSlot)==null?void 0:c.spot]})]}),timeIn:e.jsx("span",{className:"text-sm",children:new Date(i.timestamp_in).toLocaleString("en-GB")}),timeOut:i.timestamp_out?e.jsx("span",{className:"text-sm",children:new Date(i.timestamp_out).toLocaleString("en-GB")}):e.jsx("span",{className:"text-sm text-gray-500",children:"-"}),rawData:i}}),M=()=>d?e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:" text-mediumGray mb-2 flex items-start gap-2 justify-center w-full",children:[e.jsx(ne,{className:"w-5 h-5"}),"  à¹„à¸¡à¹ˆà¸žà¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸„à¹‰à¸™à¸«à¸²"]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¸­à¸·à¹ˆà¸™ à¸«à¸£à¸·à¸­",e.jsx("button",{onClick:w,className:"text-primary hover:underline ml-1",children:"à¸¥à¹‰à¸²à¸‡à¸à¸²à¸£à¸„à¹‰à¸™à¸«à¸²"})]})]}):"à¹„à¸¡à¹ˆà¸žà¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥";return t?e.jsx(Z,{message:"à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥..."}):e.jsxs("div",{className:"flex flex-col gap-4 p-4",children:[e.jsx(se,{pageName:"à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸£à¸–"}),e.jsx("div",{className:"bg-white p-2 rounded w-fit",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>b("AB"),className:`px-4 py-2 rounded-md ${P==="AB"?"bg-primary text-secondary":"text-header hover:bg-secondary"}`,disabled:r,children:"à¸¥à¸²à¸™à¸ˆà¸­à¸”à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”"}),e.jsx("button",{onClick:()=>b("A"),className:`px-4 py-2 rounded-md ${P==="A"?"bg-primary text-secondary":"text-header hover:bg-secondary"}`,disabled:r,children:"à¸¥à¸²à¸™à¸ˆà¸­à¸” A"}),e.jsx("button",{onClick:()=>b("B"),className:`px-4 py-2 rounded-md ${P==="B"?"bg-primary text-secondary":"text-header hover:bg-secondary"}`,disabled:r,children:"à¸¥à¸²à¸™à¸ˆà¸­à¸” B"})]})}),e.jsxs("div",{className:"bg-white rounded",children:[e.jsx(ae,{searchConfig:x,onSearch:B,onClear:u,filters:I}),y&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:y}),e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("div",{className:"flex justify-between items-center pb-4",children:e.jsx("div",{className:"text-header",children:d?`à¸œà¸¥à¸à¸²à¸£à¸„à¹‰à¸™à¸«à¸² (${p.meta.total})`:`à¸ˆà¸³à¸™à¸§à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (${p.meta.total})`})}),e.jsx("div",{children:e.jsx(ie,{headers:de,data:f(),emptyMessage:M(),maxHeight:"400px",rowClassName:()=>"hover:bg-gray-50 transition-colors",actions:i=>e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>_(i.rawData,"history"),className:"text-gray-600 hover:text-gray-900 transition-colors",title:"à¸”à¸¹à¸›à¸£à¸°à¸§à¸±à¸•à¸´",disabled:r,children:e.jsx(le,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>_(i.rawData,"info"),className:"text-gray-600 hover:text-gray-900 transition-colors",title:"à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",disabled:r,children:e.jsx(ce,{className:"h-5 w-5"})})]})})})]})]}),p.meta.total>0&&e.jsx(K,{currentPage:Number(I.page)||1,totalPages:Number(p.meta.totalPages)||1,onPageChange:T,totalItems:Number(p.meta.total)||0,itemsPerPage:Number(I.limit)||10}),k&&H&&e.jsx(xe,{isOpen:H,onClose:E,car:k}),G&&L&&e.jsx(pe,{isOpen:L,onClose:E,car:G,onPageChange:S})]})};export{ke as default};
